<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/layout}">
<head>
    <title>Form Danh mục</title>
</head>
<body>
    <div layout:fragment="content">
        <!-- Page Header -->
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h2>
                <i class="fas fa-edit me-2"></i>
                <span th:text="${category.id != null ? 'Chỉnh sửa Danh mục' : 'Thêm mới Danh mục'}">Form Danh mục</span>
            </h2>
            <a th:href="@{/categories}" class="btn btn-secondary">
                <i class="fas fa-arrow-left me-1"></i>Quay lại
            </a>
        </div>

        <!-- Breadcrumb -->
        <nav aria-label="breadcrumb" class="mb-4">
            <ol class="breadcrumb">
                <li class="breadcrumb-item">
                    <a th:href="@{/categories}">
                        <i class="fas fa-home me-1"></i>Trang chủ
                    </a>
                </li>
                <li class="breadcrumb-item">
                    <a th:href="@{/categories}">Danh mục</a>
                </li>
                <li class="breadcrumb-item active" aria-current="page"
                    th:text="${category.id != null ? 'Chỉnh sửa' : 'Thêm mới'}">Form</li>
            </ol>
        </nav>

        <div class="row justify-content-center">
            <div class="col-lg-8">
                <div class="card shadow">
                    <div class="card-header bg-primary text-white">
                        <h5 class="card-title mb-0">
                            <i th:class="${category.id != null ? 'fas fa-edit' : 'fas fa-plus'} me-2"></i>
                            <span th:text="${category.id != null ? 'Cập nhật thông tin' : 'Nhập thông tin mới'}">Thông tin danh mục</span>
                        </h5>
                    </div>
                    <div class="card-body">
                        <form th:action="${category.id != null ? '/categories/edit/' + category.id : '/categories/new'}"
                              th:object="${category}" method="post" novalidate>

                            <!-- Tên danh mục -->
                            <div class="mb-4">
                                <label for="name" class="form-label fw-bold">
                                    <i class="fas fa-tag me-1 text-primary"></i>
                                    Tên danh mục <span class="text-danger">*</span>
                                </label>
                                <input type="text"
                                       class="form-control form-control-lg"
                                       th:class="${#fields.hasErrors('name')} ? 'form-control form-control-lg is-invalid' : 'form-control form-control-lg'"
                                       id="name"
                                       th:field="*{name}"
                                       placeholder="Nhập tên danh mục..."
                                       maxlength="100">
                                <div class="invalid-feedback" th:if="${#fields.hasErrors('name')}" th:errors="*{name}">
                                    Lỗi tên danh mục
                                </div>
                                <div class="form-text">
                                    <i class="fas fa-info-circle me-1"></i>
                                    Tên danh mục phải từ 2-100 ký tự
                                </div>
                            </div>

                            <!-- Mô tả -->
                            <div class="mb-4">
                                <label for="description" class="form-label fw-bold">
                                    <i class="fas fa-align-left me-1 text-info"></i>
                                    Mô tả
                                </label>
                                <textarea class="form-control"
                                         th:class="${#fields.hasErrors('description')} ? 'form-control is-invalid' : 'form-control'"
                                         id="description"
                                         th:field="*{description}"
                                         rows="4"
                                         placeholder="Nhập mô tả cho danh mục..."
                                         maxlength="500"></textarea>
                                <div class="invalid-feedback" th:if="${#fields.hasErrors('description')}" th:errors="*{description}">
                                    Lỗi mô tả
                                </div>
                                <div class="form-text">
                                    <i class="fas fa-info-circle me-1"></i>
                                    Mô tả không được quá 500 ký tự (<span id="charCount">0</span>/500)
                                </div>
                            </div>

                            <!-- Trạng thái -->
                            <div class="mb-4">
                                <label class="form-label fw-bold">
                                    <i class="fas fa-toggle-on me-1 text-success"></i>
                                    Trạng thái
                                </label>
                                <div class="form-check form-switch">
                                    <input class="form-check-input"
                                           type="checkbox"
                                           id="status"
                                           th:field="*{status}">
                                    <label class="form-check-label" for="status">
                                        <span class="status-text">Hoạt động</span>
                                        <small class="text-muted ms-2">
                                            (Bỏ chọn để vô hiệu hóa danh mục)
                                        </small>
                                    </label>
                                </div>
                            </div>

                            <!-- Thông tin bổ sung nếu đang chỉnh sửa -->
                            <div th:if="${category.id != null}" class="alert alert-info">
                                <h6><i class="fas fa-info-circle me-2"></i>Thông tin bổ sung:</h6>
                                <div class="row">
                                    <div class="col-md-6">
                                        <small><strong>ID:</strong> <span th:text="${category.id}">1</span></small>
                                    </div>
                                    <div class="col-md-6">
                                        <small><strong>Ngày tạo:</strong>
                                            <span th:text="${category.createdDate != null ? #dates.format(category.createdDate, 'dd/MM/yyyy HH:mm') : 'N/A'}">01/01/2024</span>
                                        </small>
                                    </div>
                                </div>
                            </div>

                            <!-- Buttons -->
                            <div class="row">
                                <div class="col-md-6">
                                    <button type="submit" class="btn btn-primary btn-lg w-100">
                                        <i th:class="${category.id != null ? 'fas fa-save' : 'fas fa-plus'} me-2"></i>
                                        <span th:text="${category.id != null ? 'Cập nhật' : 'Thêm mới'}">Lưu</span>
                                    </button>
                                </div>
                                <div class="col-md-6">
                                    <a th:href="@{/categories}" class="btn btn-outline-secondary btn-lg w-100">
                                        <i class="fas fa-times me-2"></i>Hủy bỏ
                                    </a>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Preview Card -->
                <div class="card mt-4" id="previewCard" style="display: none;">
                    <div class="card-header bg-light">
                        <h6 class="mb-0">
                            <i class="fas fa-eye me-2"></i>Xem trước
                        </h6>
                    </div>
                    <div class="card-body">
                        <h5 id="previewName">Tên danh mục</h5>
                        <p id="previewDescription" class="text-muted">Mô tả danh mục</p>
                        <span id="previewStatus" class="badge bg-success">Hoạt động</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Custom JavaScript for this page -->
    <script layout:fragment="scripts">
        document.addEventListener('DOMContentLoaded', function() {
            const nameInput = document.getElementById('name');
            const descriptionInput = document.getElementById('description');
            const statusInput = document.getElementById('status');
            const charCount = document.getElementById('charCount');
            const statusText = document.querySelector('.status-text');
            const previewCard = document.getElementById('previewCard');
            const previewName = document.getElementById('previewName');
            const previewDescription = document.getElementById('previewDescription');
            const previewStatus = document.getElementById('previewStatus');

            // Character counter for description
            function updateCharCount() {
                const count = descriptionInput.value.length;
                charCount.textContent = count;
                charCount.className = count > 400 ? 'text-warning' : 'text-muted';
            }

            // Update status text
            function updateStatusText() {
                statusText.textContent = statusInput.checked ? 'Hoạt động' : 'Không hoạt động';
                statusText.className = statusInput.checked ? 'text-success' : 'text-muted';
            }

            // Preview functionality
            function updatePreview() {
                const hasName = nameInput.value.trim() !== '';
                const hasDescription = descriptionInput.value.trim() !== '';

                if (hasName || hasDescription) {
                    previewName.textContent = nameInput.value || 'Tên danh mục';
                    previewDescription.textContent = descriptionInput.value || 'Không có mô tả';
                    previewStatus.textContent = statusInput.checked ? 'Hoạt động' : 'Không hoạt động';
                    previewStatus.className = statusInput.checked ? 'badge bg-success' : 'badge bg-secondary';
                    previewCard.style.display = 'block';
                } else {
                    previewCard.style.display = 'none';
                }
            }

            // Event listeners
            descriptionInput.addEventListener('input', updateCharCount);
            statusInput.addEventListener('change', updateStatusText);
            nameInput.addEventListener('input', updatePreview);
            descriptionInput.addEventListener('input', updatePreview);
            statusInput.addEventListener('change', updatePreview);

            // Initialize
            updateCharCount();
            updateStatusText();
            updatePreview();
        });
    </script>
</body>
</html>